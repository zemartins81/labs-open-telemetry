# Sistema de Temperatura por CEP

Sistema distribuÃ­do em Go composto por dois microserviÃ§os que fornecem informaÃ§Ãµes de temperatura baseadas em CEP brasileiro.

## ğŸ“‹ VisÃ£o Geral

- **ServiÃ§o A**: Recebe e valida CEPs, encaminha para o ServiÃ§o B
- **ServiÃ§o B**: Busca localizaÃ§Ã£o (ViaCEP) e temperatura (WeatherAPI)

## ğŸ—ï¸ Arquitetura

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    HTTP POST     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             â”‚   /{cep}         â”‚             â”‚
â”‚  ServiÃ§o A  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  ServiÃ§o B  â”‚
â”‚   (8080)    â”‚                  â”‚   (8081)    â”‚
â”‚             â”‚                  â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚                   â”‚
                              â”‚   APIs Externas   â”‚
                              â”‚                   â”‚
                              â”‚ ViaCEP + Weather  â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ InÃ­cio RÃ¡pido

### PrÃ©-requisitos

1. **Go 1.21+** (para desenvolvimento local)
2. **Docker & Docker Compose** (recomendado)
3. **Chave WeatherAPI** (gratuita)

### 1. Obter Chave da WeatherAPI

1. Acesse [WeatherAPI.com](https://www.weatherapi.com/)
2. Crie uma conta gratuita
3. VÃ¡ em "My Account" â†’ "API Keys"
4. Copie sua chave

### 2. Configurar Ambiente

```bash
# Clone ou configure os arquivos
cp .env.example .env

# Edite o arquivo .env e adicione sua chave
WEATHER_API_KEY=sua_chave_aqui
```

### 3. Executar com Docker Compose

```bash
# Subir todos os serviÃ§os
docker-compose up --build

# Em background
docker-compose up --build -d
```

### 4. Testar o Sistema

```bash
# Teste com CEP vÃ¡lido (Av. Paulista - SÃ£o Paulo)
curl -X POST http://localhost:8080 \
  -H "Content-Type: application/json" \
  -d '{"cep": "01310100"}'

# Resposta esperada:
# {
#   "city": "SÃ£o Paulo",
#   "temp_C": 23.5,
#   "temp_F": 74.3,
#   "temp_K": 296.65
# }
```

## ğŸ“ Estrutura do Projeto

```
sistema-temperatura-cep/
â”œâ”€â”€ servico-a/                  # MicroserviÃ§o A (validaÃ§Ã£o e roteamento)
â”‚   â”œâ”€â”€ cmd/main.go
â”‚   â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ Makefile
â”‚   â””â”€â”€ README.md
â”œâ”€â”€ servico-b/                  # MicroserviÃ§o B (orquestraÃ§Ã£o de APIs)
â”‚   â”œâ”€â”€ cmd/main.go
â”‚   â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ Makefile
â”‚   â””â”€â”€ README.md
â”œâ”€â”€ docker-compose.yml          # OrquestraÃ§Ã£o dos serviÃ§os
â”œâ”€â”€ .env.example               # Exemplo de configuraÃ§Ã£o
â””â”€â”€ README.md                  # Esta documentaÃ§Ã£o
```

## ğŸ”§ Desenvolvimento Local

### Executar ServiÃ§os Individualmente

```bash
# Terminal 1 - ServiÃ§o B
cd servico-b
WEATHER_API_KEY=sua_chave make run

# Terminal 2 - ServiÃ§o A
cd servico-a
make run
```

### Executar Testes

```bash
# ServiÃ§o A
cd servico-a && make test

# ServiÃ§o B
cd servico-b && make test
```

## ğŸ“¡ Endpoints da API

### ServiÃ§o A (Porta 8080)

#### `POST /`

Recebe CEP e retorna temperatura

**Request:**

```json
{
  "cep": "01310100"
}
```

**Response Success (200):**

```json
{
  "city": "SÃ£o Paulo",
  "temp_C": 23.5,
  "temp_F": 74.3,
  "temp_K": 296.65
}
```

**Response Error (422):**

```json
{
  "message": "invalid zipcode"
}
```

#### `GET /health`

Health check do serviÃ§o

### ServiÃ§o B (Porta 8081)

#### `POST /temperature`

Processa CEP e busca temperatura

#### `GET /health`

Health check do serviÃ§o

## ğŸ§ª Casos de Teste

```bash
# CEP vÃ¡lido
curl -X POST http://localhost:8080 \
  -H "Content-Type: application/json" \
  -d '{"cep": "01310100"}'

# CEP invÃ¡lido (formato)
curl -X POST http://localhost:8080 \
  -H "Content-Type: application/json" \
  -d '{"cep": "123"}'

# CEP nÃ£o encontrado
curl -X POST http://localhost:8080 \
  -H "Content-Type: application/json" \
  -d '{"cep": "99999999"}'

# Health checks
curl http://localhost:8080/health
curl http://localhost:8081/health
```

## ğŸ” CÃ³digos de Resposta

| CÃ³digo | DescriÃ§Ã£o |
|--------|-----------|
| 200    | Sucesso - temperatura encontrada |
| 400    | Bad Request - JSON malformado |
| 404    | CEP nÃ£o encontrado |
| 405    | MÃ©todo nÃ£o permitido |
| 422    | CEP com formato invÃ¡lido |
| 500    | Erro interno do servidor |

## ğŸŒ¡ï¸ ConversÃµes de Temperatura

- **Celsius**: Valor original da WeatherAPI
- **Fahrenheit**: F = C Ã— 1.8 + 32
- **Kelvin**: K = C + 273.15

## ğŸ› ï¸ Comandos Ãšteis

```bash
# Parar todos os serviÃ§os
docker-compose down

# Rebuild completo
docker-compose down
docker-compose build --no-cache
docker-compose up

# Ver logs
docker-compose logs -f servico-a
docker-compose logs -f servico-b

# Escalar serviÃ§os
docker-compose up --scale servico-a=2
```

## ğŸ”§ ConfiguraÃ§Ã£o AvanÃ§ada

### VariÃ¡veis de Ambiente

| VariÃ¡vel | ServiÃ§o | DescriÃ§Ã£o | PadrÃ£o |
|----------|---------|-----------|--------|
| `WEATHER_API_KEY` | B | Chave WeatherAPI (obrigatÃ³ria) | - |
| `SERVICE_B_URL` | A | URL do ServiÃ§o B | `http://localhost:8081` |
| `VIACEP_URL` | B | URL da ViaCEP | `https://viacep.com.br/ws` |
| `WEATHER_API_URL` | B | URL da WeatherAPI | `http://api.weatherapi.com/v1` |

### Portas Customizadas

```bash
# docker-compose.override.yml
version: '3.8'
services:
  servico-a:
    ports:
      - "9000:8080"
  servico-b:
    ports:
      - "9001:8081"
```

## ğŸ› Troubleshooting

### Erro: "WEATHER_API_KEY Ã© obrigatÃ³ria"

- Verifique se a chave estÃ¡ no arquivo `.env`
- Confirme se a chave Ã© vÃ¡lida no WeatherAPI

### Erro: "can not find zipcode"

- CEP pode nÃ£o existir na base ViaCEP
- Teste com CEPs conhecidos (01310100, 20040020)

### ServiÃ§os nÃ£o se comunicam

- Verifique se estÃ£o na mesma rede Docker
- Confirme URLs de comunicaÃ§Ã£o entre serviÃ§os

## ğŸ“š PrÃ³ximos Passos

- [ ] ImplementaÃ§Ã£o OpenTelemetry
- [ ] IntegraÃ§Ã£o Zipkin
- [ ] MÃ©tricas Prometheus
- [ ] Cache Redis
- [ ] Rate Limiting
- [ ] Circuit Breaker

## ğŸ¤ ContribuiÃ§Ã£o

1. Fork o projeto
2. Crie uma branch para sua feature
3. Implemente testes
4. Submeta um Pull Request

## ğŸ“„ LicenÃ§a

Este projeto estÃ¡ sob a licenÃ§a MIT.
